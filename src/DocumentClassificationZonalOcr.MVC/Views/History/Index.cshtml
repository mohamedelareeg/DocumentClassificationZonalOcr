@model int
@{
    ViewData["Title"] = "Detection History";
}

<div class="container mx-2">
    <table id="FormSamplesTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/DataTables/datatables.min.js"></script>

    <script>
        function displayImageThumbnail(input) {
            var imageThumbnail = document.getElementById("imageThumbnail");
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    imageThumbnail.innerHTML = '<img src="' + e.target.result + '" alt="Image Thumbnail" width="100" />';
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                imageThumbnail.innerHTML = '';
            }
        }
        $(document).ready(function () {

            // DataTable initialization
            var table = $('#FormSamplesTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "@Url.Action("LoadData", "History", new { formId = Model })",
                    "type": "POST",
                    "contentType": "application/json; charset=utf-8",
                    "data": function (d) {
                        return JSON.stringify({
                            draw: d.draw,
                            start: d.start,
                            length: d.length,
                            searchText: d.search.value,
                            orderBy: d.order.map(o => `${d.columns[o.column].data} ${o.dir}`).join(', '),
                            fromDate: $('#fromDate').val(),
                            toDate: $('#toDate').val()
                        });
                    }
                },
                "columns": [
                    { "data": "serial" },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return '<img src="' + row.imagePath + '" alt="Image" style="max-width:100px; max-height:100px;">';
                        }
                    },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            return '<a  class="btn btn-warning">Edit</a>';
                        }
                    }
                ]
            });
            // Function to delete form sample
            function deleteFormSample(id) {
                if (confirm("Are you sure you want to delete this form sample?")) {
                    $.ajax({
                        url: '@Url.Action("Delete", "FormSample")/' + id,
                        type: 'DELETE',
                        success: function (result) {
                            $('#FormSamplesTable').DataTable().ajax.reload();
                        },
                        error: function (err) {
                            alert('Error deleting form sample');
                        }
                    });
                }
            }
        });
    </script>
}
